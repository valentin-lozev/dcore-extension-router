var dcore;!function(dcore){!function(routing){"use strict";var UrlHash=function(){function UrlHash(){this.tokens=[],this.queryParams=[],this.questionMarkIndex=-1,this.url=""}return Object.defineProperty(UrlHash.prototype,"value",{get:function(){return this.url},set:function(url){url=url||"",this.url=url,this.questionMarkIndex=url.indexOf("?"),this.queryParams=[],this.tokens=[],this.populateQueryParams(),this.populateTokens()},enumerable:!0,configurable:!0}),UrlHash.prototype.anyQueryParams=function(){return this.questionMarkIndex>-1},UrlHash.prototype.populateQueryParams=function(){var _this=this;this.anyQueryParams()&&(this.queryParams=this.value.substring(this.questionMarkIndex+1).split("&").map(function(keyValuePairString){return _this.parseQueryParam(keyValuePairString)}))},UrlHash.prototype.parseQueryParam=function(keyValuePair){var args=keyValuePair.split("=");return{key:args[0],value:args[1]||""}},UrlHash.prototype.populateTokens=function(){var valueWithoutQuery=this.getValueWithoutQuery();this.tokens=valueWithoutQuery.split("/").filter(function(token){return""!==token})},UrlHash.prototype.getValueWithoutQuery=function(){return this.anyQueryParams()?this.value.substring(0,this.value.length-(this.value.length-this.questionMarkIndex)):this.value},UrlHash}();routing.UrlHash=UrlHash}(dcore.routing||(dcore.routing={}))}(dcore||(dcore={}));var dcore;!function(dcore){!function(routing){"use strict";var routeParamRegex=/{([a-zA-Z]+)}/,Route=function(){function Route(pattern,onStart){this.tokens=[];var errorMsg="Route registration failed:";if("string"!=typeof pattern)throw new TypeError(errorMsg+" pattern should be non empty string.");if("function"!=typeof onStart)throw new TypeError(errorMsg+" callback should be a function.");this.pattern=pattern,this.callback=onStart,this.populateTokens()}return Route.prototype.getTokens=function(){return this.tokens.slice(0)},Route.prototype.equals=function(hashUrl){if(this.tokens.length!==hashUrl.tokens.length)return!1;for(var i=0,len=this.tokens.length;i<len;i++){var token=this.tokens[i],urlToken=hashUrl.tokens[i];if(!token.isDynamic&&token.name.toLowerCase()!==urlToken.toLowerCase())return!1}return!0},Route.prototype.start=function(urlHash){if(this.queryParams=Object.freeze(this.getParamsFromUrl(urlHash)),this.callback)try{this.callback(this.queryParams,this.pattern)}catch(error){console.error("Couldn't start "+urlHash.value+" route due to:"),console.error(error)}},Route.prototype.populateTokens=function(){var _this=this;this.tokens=[],this.pattern.split("/").forEach(function(urlFragment){""!==urlFragment&&_this.tokens.push(_this.parseToken(urlFragment))})},Route.prototype.parseToken=function(urlFragment){var paramMatchGroups=routeParamRegex.exec(urlFragment),isDynamic=!!paramMatchGroups;return{name:isDynamic?paramMatchGroups[1]:urlFragment,isDynamic:isDynamic}},Route.prototype.getParamsFromUrl=function(url){var result=this.getQueryParamsFromUrl(url);return this.tokens.forEach(function(token,index){token.isDynamic&&(result[token.name]=url.tokens[index])}),result},Route.prototype.getQueryParamsFromUrl=function(url){var result={};return url.queryParams.forEach(function(param){return result[param.key]=param.value}),result},Route}();routing.Route=Route}(dcore.routing||(dcore.routing={}))}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";var plugin=dcore.routing,Routing=function(){function Routing(){this.defaultUrl=null,this.routes=[],this.urlHash=new plugin.UrlHash}return Routing.prototype.register=function(pattern,callback){if(this.routes.some(function(r){return r.pattern===pattern}))throw new Error("register(): Route "+pattern+" has been already registered.");this.routes.push(new plugin.Route(pattern,callback))},Routing.prototype.startRoute=function(hash){if(this.urlHash.value=hash,this.currentRoute=this.__findRoute(),this.currentRoute)return void this.currentRoute.start(this.urlHash);"string"==typeof this.defaultUrl?this.__startDefaultRoute(hash):console.warn("No route matches "+hash)},Routing.prototype.getCurrentRoute=function(){return{pattern:this.currentRoute?this.currentRoute.pattern:null,params:this.currentRoute?this.currentRoute.queryParams:null}},Routing.prototype.getRoutes=function(){return this.routes.map(function(route){return route.pattern})},Routing.prototype.anyRoutes=function(){return this.routes.length>0},Routing.prototype.__findRoute=function(){for(var i=0,len=this.routes.length;i<len;i++){var route=this.routes[i];if(route.equals(this.urlHash))return route}return null},Routing.prototype.__startDefaultRoute=function(invalidHash){window.history.replaceState(null,null,window.location.pathname+"#"+this.defaultUrl),this.urlHash.value=this.defaultUrl,this.currentRoute=this.__findRoute(),this.currentRoute?this.currentRoute.start(this.urlHash):console.warn("No route handler for "+invalidHash)},Routing}();dcore.Routing=Routing}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";function sandboxGetCurrentRoute(){return this.core.routing.getCurrentRoute()}function sandboxGo(url){location.hash=url}function handleRoute(){this.routing.startRoute(window.location.hash.substring(1))}function runRouting(next){this.routing.anyRoutes()&&window.addEventListener("hashchange",handleRoute.bind(this)),next.call(this)}dcore.Application.prototype.useRouting=function(){return this.routing||(this.routing=new dcore.Routing,function(sb){sb.getCurrentRoute=sandboxGetCurrentRoute,sb.go=sandboxGo}(this.Sandbox.prototype),this.hook(dcore.hooks.CORE_RUN,runRouting)),this}}(dcore||(dcore={}));