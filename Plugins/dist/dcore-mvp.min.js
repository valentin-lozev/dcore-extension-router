var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function asModel(target){if("object"!=typeof target||null===target)return null;var model=new Model;for(var key in model)target[key]=model[key];return target}mvp.ModelEvents={Change:"change",Destroy:"destroy"},mvp.asModel=asModel;var Model=function(){function Model(){this.listeners={}}return Model.prototype.on=function(eventType,handler,context){return!!eventType&&(this.listeners[eventType]=this.listeners[eventType]||[],this.listeners[eventType].push({handler:handler,context:context}),!0)},Model.prototype.off=function(eventType,handler,context){for(var listeners=this.listeners[eventType]||[],i=0,len=listeners.length;i<len;i++){var listener=listeners[i];if(listener.handler===handler&&listener.context===context)return listener=listeners[len-1],listeners.length--,!0}return!1},Model.prototype.notify=function(type,data){Array.isArray(this.listeners[type])&&this.listeners[type].slice(0).forEach(function(listener){return listener.handler.call(listener.context,data)})},Model.prototype.change=function(){this.notify(mvp.ModelEvents.Change,this)},Model.prototype.destroy=function(){this.notify(mvp.ModelEvents.Destroy,this)},Model}();mvp.Model=Model}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";var HashSet=function(){function HashSet(){this.items={},this.size=0}return HashSet.prototype.contains=function(item){var hashCode=item.hash();if(!Object.prototype.hasOwnProperty.call(this.items,hashCode))return!1;var hashedItems=this.items[hashCode];if(!Array.isArray(hashedItems))return hashedItems.equals(item);for(var i=0,len=hashedItems.length;i<len;i++)if(hashedItems[i].equals(item))return!0;return!1},HashSet.prototype.add=function(item){if(null===item||"undefined"==typeof item||this.contains(item))return!1;var hashCode=item.hash();return Object.prototype.hasOwnProperty.call(this.items,hashCode)?Array.isArray(this.items[hashCode])?this.items[hashCode].push(item):this.items[hashCode]=[this.items[hashCode],item]:this.items[hashCode]=item,this.size++,!0},HashSet.prototype.remove=function(item){if(!this.contains(item))return!1;var hashCode=item.hash();if(Array.isArray(this.items[hashCode])){for(var hashCodeItems=this.items[hashCode],i=0,len=hashCodeItems.length;i<len;i++)if(hashCodeItems[i].equals(item)){hashCodeItems[i]=hashCodeItems[len-1],hashCodeItems.length--;break}}else delete this.items[hashCode];return this.size--,!0},HashSet.prototype.clear=function(){return!(this.size<=0)&&(this.items={},this.size=0,!0)},HashSet.prototype.forEach=function(action,context){for(var index=0,hashes=Object.keys(this.items),i=0,len=hashes.length;i<len;i++){var hashIndexItem=this.items[hashes[i]];if(Array.isArray(hashIndexItem))for(var j=0,hashLength=hashIndexItem.length;j<hashLength;j++)action.call(context,hashIndexItem[j],index),index++;else action.call(context,hashIndexItem,index),index++}},HashSet.prototype.toArray=function(){for(var result=new Array(this.size),index=0,hashes=Object.keys(this.items),i=0,hashesLen=hashes.length;i<hashesLen;i++){var hashIndexItem=this.items[hashes[i]];if(Array.isArray(hashIndexItem))for(var j=0,len=hashIndexItem.length;j<len;j++)result[index]=hashIndexItem[j],index++;else result[index]=hashIndexItem,index++}return result},HashSet}();mvp.HashSet=HashSet}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function onItemChange(item){this.notify(mvp.CollectionEvents.UpdatedItem,item)}function onItemDestroy(item){this.removeRange([item])}mvp.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var Collection=function(_super){function Collection(){_super.call(this),this.models=new mvp.HashSet}return __extends(Collection,_super),Object.defineProperty(Collection.prototype,"size",{get:function(){return this.models.size},enumerable:!0,configurable:!0}),Collection.prototype.equals=function(other){return!1},Collection.prototype.hash=function(){return 17^this.size},Collection.prototype.add=function(model){return this.addRange([model])},Collection.prototype.addRange=function(models){for(var added=[],i=0,len=models.length;i<len;i++){var model=models[i];this.models.add(model)&&(model.on(mvp.ModelEvents.Change,onItemChange,this),model.on(mvp.ModelEvents.Destroy,onItemDestroy,this),added.push(model))}var isModified=added.length>0;return isModified&&this.notify(mvp.CollectionEvents.AddedItems,added),isModified},Collection.prototype.remove=function(model){return this.removeRange([model])},Collection.prototype.removeRange=function(models){for(var deleted=[],i=0,len=models.length;i<len;i++){var model=models[i];this.models.remove(model)&&(model.off(mvp.ModelEvents.Change,onItemChange,this),model.off(mvp.ModelEvents.Destroy,onItemDestroy,this),deleted.push(model))}var isModified=deleted.length>0;return isModified&&this.notify(mvp.CollectionEvents.DeletedItems,deleted),isModified},Collection.prototype.clear=function(){return this.removeRange(this.toArray())},Collection.prototype.contains=function(model){return this.models.contains(model)},Collection.prototype.any=function(){return this.size>0},Collection.prototype.toArray=function(){return this.models.toArray()},Collection.prototype.forEach=function(action,context){this.models.forEach(action,context)},Collection}(mvp.Model);mvp.Collection=Collection}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function removeEvent(name){var ev,type,handler,useCapture;ev=this.events[name],useCapture=ev.useCapture,type=ev.eventType,handler=ev.handler,this.removeEventListener(type,handler,useCapture),delete this.eventsList[name]}function detachEvent(name){var i;if(void 0===name||""===name){for(i in this.eventsList)removeEvent.call(this,i);this.eventsList={}}else this.hasEvent(name)&&removeEvent.call(this,name);return this.eventsList}function hasEvent(name){return"object"==typeof this.eventsList[name]&&this.eventsList[name]}function triggerEvent(name){var evt=this.hasEvent(name);return"function"==typeof evt.handler&&evt.handler()}function UIEvent(config){return this instanceof UIEvent?(this.htmlElement=config.htmlElement,this.eventConfig={name:config.name,eventType:config.eventType,handler:void 0!==config.handler&&config.handler,useCapture:void 0!==config.useCapture&&config.useCapture,context:void 0===config.context?null:config.context},void this.init()):new UIEvent(config)}Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,mvp.UIEvent=UIEvent,UIEvent.prototype.init=function(){if(void 0===this.htmlElement.eventsList)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(e){return this.eventsList[e.name]=e}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:triggerEvent},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:hasEvent},detach:{writable:!1,enumerable:!1,configurable:!1,value:detachEvent}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this),this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture),this.htmlElement.events=this.eventConfig},Object.defineProperties(UIEvent.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return detachEvent.call(this.htmlElement,name)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return triggerEvent.call(this.htmlElement,name||this.eventConfig.name)}}})}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function eventHandler(ev){var target=ev.target,dataset=target.dataset;if(dataset.hasOwnProperty(ev.type)){var callbackName=dataset[ev.type];return"function"==typeof this[callbackName]?void this[callbackName](ev):void 0}}var View=function(){function View(domNode,template){if(!domNode)throw new Error("Dom node cannot be null.");this._domNode=domNode,this.template=template}return Object.defineProperty(View.prototype,"domNode",{get:function(){return this._domNode},enumerable:!0,configurable:!0}),View.prototype.map=function(eventType,useCapture,selector){return void 0===useCapture&&(useCapture=!1),mvp.UIEvent({name:eventType,htmlElement:selector?this.domNode.querySelector(selector):this.domNode,handler:eventHandler,eventType:eventType,context:this,useCapture:useCapture}),this},View.prototype.render=function(model){return this.template&&(this.domNode.innerHTML=this.template.call(this,model)),this.domNode},View.prototype.destroy=function(){return"function"==typeof this.domNode.detach&&this.domNode.detach(),this.removeAllElements(),this._domNode=null,this},View.prototype.query=function(selector){return this.domNode.querySelector(selector)},View.prototype.removeElement=function(selector){var element=this.query(selector);return element&&element.parentElement.removeChild(element),this},View.prototype.removeAllElements=function(){for(;this.domNode.firstElementChild;)this.domNode.removeChild(this.domNode.firstElementChild);return this},View}();mvp.View=View}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";var Presenter=function(){function Presenter(){this._view=null,this._model=null,this._modelHandlers={}}return Object.defineProperty(Presenter.prototype,"view",{get:function(){return this._view},set:function(value){this.view!==value&&(this.view&&this.view.destroy(),this._view=value)},enumerable:!0,configurable:!0}),Object.defineProperty(Presenter.prototype,"model",{get:function(){return this._model},set:function(model){var _this=this;this._model!==model&&(Object.keys(this._modelHandlers).forEach(function(type){var eventHandler=_this._modelHandlers[type];_this._model&&_this._model.off(type,eventHandler,_this),model&&model.on(type,eventHandler,_this)}),this._model=model,this.render())},enumerable:!0,configurable:!0}),Presenter.prototype.onModel=function(eventType,handler){return eventType&&handler&&(this._modelHandlers[eventType]=handler),this},Presenter.prototype.render=function(){return this.view?this.view.render(this.model):null},Presenter.prototype.destroy=function(){this.view=null,this.model=null},Presenter}();mvp.Presenter=Presenter}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";var mvp=dcore.plugins.mvp;dcore.Instance.prototype.useMVP=function(){var that=this;that.mvp||(that.mvp={Model:mvp.Model,asMVPModel:mvp.asModel,ModelEvents:mvp.ModelEvents,Collection:mvp.Collection,CollectionEvents:mvp.CollectionEvents,View:mvp.View,Presenter:mvp.Presenter})}}(dcore||(dcore={}));