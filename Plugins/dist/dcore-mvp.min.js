var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function asModel(target){if("object"!=typeof target||null===target)return null;var model=new Model;for(var key in model)target[key]=model[key];return target}mvp.ModelEvents={Change:"change",Destroy:"destroy"},mvp.asModel=asModel;var Model=function(){function Model(){this.listeners={}}return Model.prototype.on=function(eventType,handler,context){return!!eventType&&(this.listeners[eventType]=this.listeners[eventType]||[],this.listeners[eventType].push({handler:handler,context:context}),!0)},Model.prototype.off=function(eventType,handler,context){for(var listeners=this.listeners[eventType]||[],i=0,len=listeners.length;i<len;i++){var listener=listeners[i];if(listener.handler===handler&&listener.context===context)return listener=listeners[len-1],listeners.length--,!0}return!1},Model.prototype.notify=function(type,data){Array.isArray(this.listeners[type])&&this.listeners[type].slice(0).forEach(function(listener){return listener.handler.call(listener.context,data)})},Model.prototype.change=function(){this.notify(mvp.ModelEvents.Change,this)},Model.prototype.destroy=function(){this.notify(mvp.ModelEvents.Destroy,this)},Model}();mvp.Model=Model}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function onItemChange(item){this.notify(mvp.CollectionEvents.UpdatedItem,item)}function onItemDestroy(item){this.removeRange([item])}mvp.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var Collection=function(_super){function Collection(models){_super.call(this),this.modelList=[],Array.isArray(models)&&this.addRange(models)}return __extends(Collection,_super),Object.defineProperty(Collection.prototype,"size",{get:function(){return this.modelList.length},enumerable:!0,configurable:!0}),Collection.prototype.add=function(model){model&&this.addRange([model])},Collection.prototype.addRange=function(models){var _this=this;Array.isArray(models)&&(models.forEach(function(m){m.on(mvp.ModelEvents.Change,onItemChange,_this),m.on(mvp.ModelEvents.Destroy,onItemDestroy,_this),_this.modelList.push(m)}),this.notify(mvp.CollectionEvents.AddedItems,models))},Collection.prototype.remove=function(model){this.removeRange([model])},Collection.prototype.removeRange=function(models){if(Array.isArray(models)){for(var deleted=[],i=0,len=models.length;i<len;i++){var model=models[i],atIndex=this.modelList.indexOf(model);atIndex<0||(model.off(mvp.ModelEvents.Change,onItemChange,this),model.off(mvp.ModelEvents.Destroy,onItemDestroy,this),this.modelList[atIndex]=this.modelList[this.size-1],this.modelList.length--,deleted.push(model))}var isModified=deleted.length>0;isModified&&this.notify(mvp.CollectionEvents.DeletedItems,deleted)}},Collection.prototype.clear=function(){this.removeRange(this.toArray())},Collection.prototype.contains=function(model){return this.modelList.indexOf(model)>=0},Collection.prototype.any=function(){return this.size>0},Collection.prototype.toArray=function(){return this.modelList.slice(0)},Collection.prototype.forEach=function(action,context){this.modelList.forEach(action,context)},Collection}(mvp.Model);mvp.Collection=Collection}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={})),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){for(var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;--i>=0&&matches.item(i)!==this;);return i>-1});var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,EventListenerConfig=function(){function EventListenerConfig(type,selector,listener,useCapture,context){this.type=type,this.selector=selector,this.listener=listener,this.useCapture=useCapture,this.context=context}return EventListenerConfig.prototype.handleEvent=function(ev){var target=ev.target;do{if(target.matches(this.selector))return ev.delegateTarget=target,void this.listener.call(this.context,ev);target=target.parentElement}while(target&&target!==this.context.root)},EventListenerConfig}(),View=function(){function View(root){this.eventListeners={},this.root=root}return View.prototype.render=function(data){return this.root},View.prototype.addEventListeners=function(configs){var _this=this;return Array.isArray(configs)&&configs.forEach(function(c){return _this.addEventListener(c)}),this},View.prototype.addEventListener=function(config){if("object"!=typeof config||null===config)throw new TypeError("Listener config must be passed as object.");var eventType=config.type;if("string"!=typeof eventType)throw new TypeError("Event type must be a string.");var configObj=new EventListenerConfig(eventType,config.selector,config.listener,!!config.useCapture,this),key=eventType+" "+configObj.selector+" "+configObj.useCapture;return hasOwnProperty.call(this.eventListeners,key)?this:(configObj.handleEvent=configObj.handleEvent.bind(configObj),this.root.addEventListener(eventType,configObj.handleEvent,configObj.useCapture),this.eventListeners[key]=configObj,this)},View.prototype.destroy=function(){var _this=this;Object.keys(this.eventListeners).forEach(function(type){var listener=_this.eventListeners[type];_this.root.removeEventListener(listener.type,listener.handleEvent,listener.useCapture),delete _this.eventListeners[type]}),this.eventListeners={},this.root=null},View}();mvp.View=View}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";var Presenter=function(){function Presenter(view){this._model=null,this._view=null,this._modelHandlers={},this._view=view}return Object.defineProperty(Presenter.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(Presenter.prototype,"model",{get:function(){return this._model},set:function(model){var _this=this;if(this.model!==model){var shouldDetach=this.model instanceof mvp.Model,shouldAttach=model instanceof mvp.Model;Object.keys(this._modelHandlers).forEach(function(type){var eventHandler=_this._modelHandlers[type];shouldDetach&&_this.model.off(type,eventHandler,_this),shouldAttach&&model.on(type,eventHandler,_this)}),this._model=model}},enumerable:!0,configurable:!0}),Presenter.prototype.onModel=function(eventType,handler){return eventType&&handler&&(this._modelHandlers[eventType]=handler),this},Presenter.prototype.render=function(){return this.view.render(this.model)},Presenter.prototype.destroy=function(){this.model=null,this._view.destroy(),this._view=null},Presenter}();mvp.Presenter=Presenter}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";var mvp=dcore.plugins.mvp;dcore.Instance.prototype.useMVP=function(){var that=this;that.mvp||(that.mvp={Model:mvp.Model,asMVPModel:mvp.asModel,ModelEvents:mvp.ModelEvents,Collection:mvp.Collection,CollectionEvents:mvp.CollectionEvents,View:mvp.View,Presenter:mvp.Presenter},that.Sandbox.prototype.asMVPModel=mvp.asModel)}}(dcore||(dcore={}));