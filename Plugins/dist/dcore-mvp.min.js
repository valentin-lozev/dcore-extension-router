var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function asModel(target){if("object"!=typeof target||null===target)return null;var model=new Model;for(var key in model)target[key]=model[key];return target}mvp.ModelEvents={Change:"change",Destroy:"destroy"},mvp.asModel=asModel;var Model=function(){function Model(){this.listeners={}}return Model.prototype.on=function(eventType,handler,context){return!!eventType&&(this.listeners[eventType]=this.listeners[eventType]||[],this.listeners[eventType].push({handler:handler,context:context}),!0)},Model.prototype.off=function(eventType,handler,context){for(var listeners=this.listeners[eventType]||[],i=0,len=listeners.length;i<len;i++){var listener=listeners[i];if(listener.handler===handler&&listener.context===context)return listener=listeners[len-1],listeners.length--,!0}return!1},Model.prototype.notify=function(type,data){Array.isArray(this.listeners[type])&&this.listeners[type].slice(0).forEach(function(listener){return listener.handler.call(listener.context,data)})},Model.prototype.change=function(){this.notify(mvp.ModelEvents.Change,this)},Model.prototype.destroy=function(){this.notify(mvp.ModelEvents.Destroy,this)},Model}();mvp.Model=Model}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function onItemChange(item){this.notify(mvp.CollectionEvents.UpdatedItem,item)}function onItemDestroy(item){this.removeRange([item])}mvp.CollectionEvents={AddedItems:"added-items",DeletedItems:"deleted-items",UpdatedItem:"updated-item"};var Collection=function(_super){function Collection(){_super.call(this),this.models=[]}return __extends(Collection,_super),Object.defineProperty(Collection.prototype,"size",{get:function(){return this.models.length},enumerable:!0,configurable:!0}),Collection.prototype.add=function(model){model&&this.addRange([model])},Collection.prototype.addRange=function(models){var _this=this;Array.isArray(models)&&(models.forEach(function(m){m.on(mvp.ModelEvents.Change,onItemChange,_this),m.on(mvp.ModelEvents.Destroy,onItemDestroy,_this),_this.models.push(m)}),this.notify(mvp.CollectionEvents.AddedItems,models))},Collection.prototype.remove=function(model){this.removeRange([model])},Collection.prototype.removeRange=function(models){if(Array.isArray(models)){for(var deleted=[],i=0,len=models.length;i<len;i++){var model=models[i],atIndex=this.models.indexOf(model);atIndex<0||(model.off(mvp.ModelEvents.Change,onItemChange,this),model.off(mvp.ModelEvents.Destroy,onItemDestroy,this),this.models[atIndex]=this.models[this.size-1],this.models.length--,deleted.push(model))}var isModified=deleted.length>0;isModified&&this.notify(mvp.CollectionEvents.DeletedItems,deleted)}},Collection.prototype.clear=function(){this.removeRange(this.toArray())},Collection.prototype.contains=function(model){return this.models.indexOf(model)>=0},Collection.prototype.any=function(){return this.size>0},Collection.prototype.toArray=function(){return this.models.slice(0)},Collection.prototype.forEach=function(action,context){this.models.forEach(action,context)},Collection}(mvp.Model);mvp.Collection=Collection}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function removeEvent(name){var ev,type,handler,useCapture;ev=this.events[name],useCapture=ev.useCapture,type=ev.eventType,handler=ev.handler,this.removeEventListener(type,handler,useCapture),delete this.eventsList[name]}function detachEvent(name){var i;if(void 0===name||""===name){for(i in this.eventsList)removeEvent.call(this,i);this.eventsList={}}else this.hasEvent(name)&&removeEvent.call(this,name);return this.eventsList}function hasEvent(name){return"object"==typeof this.eventsList[name]&&this.eventsList[name]}function triggerEvent(name){var evt=this.hasEvent(name);return"function"==typeof evt.handler&&evt.handler()}function UIEvent(config){return this instanceof UIEvent?(this.htmlElement=config.htmlElement,this.eventConfig={name:config.name,eventType:config.eventType,handler:void 0!==config.handler&&config.handler,useCapture:void 0!==config.useCapture&&config.useCapture,context:void 0===config.context?null:config.context},void this.init()):new UIEvent(config)}Element.prototype.trigger=function(){return!1},Element.prototype.hasEvent=function(){return!1},Element.prototype.detach=function(){return!1},Element.prototype.events=!1,mvp.UIEvent=UIEvent,UIEvent.prototype.init=function(){if(void 0===this.htmlElement.eventsList)Object.defineProperties(this.htmlElement,{eventsList:{writable:!0,enumerable:!1,configurable:!1,value:{}},events:{enumerable:!1,configurable:!1,get:function(){return this.eventsList},set:function(e){return this.eventsList[e.name]=e}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:triggerEvent},hasEvent:{writable:!1,enumerable:!1,configurable:!1,value:hasEvent},detach:{writable:!1,enumerable:!1,configurable:!1,value:detachEvent}});else if(this.htmlElement.hasEvent(this.eventConfig.name))return!1;this.eventConfig.handler=this.eventConfig.handler.bind(this.eventConfig.context||this),this.htmlElement.addEventListener(this.eventConfig.eventType,this.eventConfig.handler,this.eventConfig.useCapture),this.htmlElement.events=this.eventConfig},Object.defineProperties(UIEvent.prototype,{detach:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return detachEvent.call(this.htmlElement,name)}},trigger:{writable:!1,enumerable:!1,configurable:!1,value:function(name){return triggerEvent.call(this.htmlElement,name||this.eventConfig.name)}}})}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";function eventHandler(ev){var target=ev.target,dataset=target.dataset;if(dataset.hasOwnProperty(ev.type)){var callbackName=dataset[ev.type];return"function"==typeof this[callbackName]?void this[callbackName](ev):void 0}}var View=function(){function View(root,template){if(!root)throw new Error("Root must be an html element.");this.root=root,this.template=template}return View.prototype.map=function(eventType,useCapture,selector){return void 0===useCapture&&(useCapture=!1),mvp.UIEvent({name:eventType,htmlElement:selector?this.root.querySelector(selector):this.root,handler:eventHandler,eventType:eventType,context:this,useCapture:useCapture}),this},View.prototype.render=function(model){return"function"==typeof this.template&&(this.root.innerHTML=this.template.call(this,model)),this.root},View.prototype.destroy=function(){"function"==typeof this.root.detach&&this.root.detach(),this.root=null},View.prototype.query=function(selector){return this.root.querySelector(selector)},View.prototype.removeElement=function(selector){var element=this.query(selector);return element&&element.parentElement.removeChild(element),this},View.prototype.removeAllElements=function(){for(;this.root.firstElementChild;)this.root.removeChild(this.root.firstElementChild);return this},View}();mvp.View=View}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){var plugins;!function(plugins){var mvp;!function(mvp){"use strict";var Presenter=function(){function Presenter(){this._view=null,this._model=null,this._modelHandlers={}}return Object.defineProperty(Presenter.prototype,"view",{get:function(){return this._view},set:function(value){this.view!==value&&(this.view&&this.view.destroy(),this._view=value)},enumerable:!0,configurable:!0}),Object.defineProperty(Presenter.prototype,"model",{get:function(){return this._model},set:function(model){var _this=this;this._model!==model&&(Object.keys(this._modelHandlers).forEach(function(type){var eventHandler=_this._modelHandlers[type];_this._model&&_this._model.off(type,eventHandler,_this),model&&model.on(type,eventHandler,_this)}),this._model=model,this.render())},enumerable:!0,configurable:!0}),Presenter.prototype.onModel=function(eventType,handler){return eventType&&handler&&(this._modelHandlers[eventType]=handler),this},Presenter.prototype.render=function(){return this.view?this.view.render(this.model):null},Presenter.prototype.destroy=function(){this.view=null,this.model=null},Presenter}();mvp.Presenter=Presenter}(mvp=plugins.mvp||(plugins.mvp={}))}(plugins=dcore.plugins||(dcore.plugins={}))}(dcore||(dcore={}));var dcore;!function(dcore){"use strict";var mvp=dcore.plugins.mvp;dcore.Instance.prototype.useMVP=function(){var that=this;that.mvp||(that.mvp={Model:mvp.Model,asMVPModel:mvp.asModel,ModelEvents:mvp.ModelEvents,Collection:mvp.Collection,CollectionEvents:mvp.CollectionEvents,View:mvp.View,Presenter:mvp.Presenter})}}(dcore||(dcore={}));